{"ast":null,"code":"import _classCallCheck from \"/home/asmane/vtc/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/asmane/vtc/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { checkRequired, createValidator, createValidatorAsync, isEmpty, formatErrorMessage } from './utils';\nimport locales from './locales';\nexport var MixedType = /*#__PURE__*/function () {\n  function MixedType(name) {\n    _classCallCheck(this, MixedType);\n    this.required = false;\n    this.requiredMessage = '';\n    this.trim = false;\n    this.emptyAllowed = false;\n    this.rules = [];\n    this.priorityRules = [];\n    this.typeName = name;\n    this.locale = Object.assign(name ? locales[name] : {}, locales.mixed);\n  }\n  _createClass(MixedType, [{\n    key: \"setSchemaOptions\",\n    value: function setSchemaOptions(schemaSpec, value) {\n      this.schemaSpec = schemaSpec;\n      this.value = value;\n    }\n  }, {\n    key: \"check\",\n    value: function check() {\n      var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.value;\n      var data = arguments.length > 1 ? arguments[1] : undefined;\n      var fieldName = arguments.length > 2 ? arguments[2] : undefined;\n      if (this.required && !checkRequired(value, this.trim, this.emptyAllowed)) {\n        return {\n          hasError: true,\n          errorMessage: formatErrorMessage(this.requiredMessage, {\n            name: fieldName\n          })\n        };\n      }\n      var validator = createValidator(data, fieldName);\n      var checkStatus = validator(value, this.priorityRules);\n      if (checkStatus) {\n        return checkStatus;\n      }\n      if (!this.required && isEmpty(value)) {\n        return {\n          hasError: false\n        };\n      }\n      return validator(value, this.rules) || {\n        hasError: false\n      };\n    }\n  }, {\n    key: \"checkAsync\",\n    value: function checkAsync() {\n      var _this = this;\n      var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.value;\n      var data = arguments.length > 1 ? arguments[1] : undefined;\n      var fieldName = arguments.length > 2 ? arguments[2] : undefined;\n      if (this.required && !checkRequired(value, this.trim, this.emptyAllowed)) {\n        return Promise.resolve({\n          hasError: true,\n          errorMessage: formatErrorMessage(this.requiredMessage, {\n            name: fieldName\n          })\n        });\n      }\n      var validator = createValidatorAsync(data, fieldName);\n      return new Promise(function (resolve) {\n        return validator(value, _this.priorityRules).then(function (checkStatus) {\n          if (checkStatus) {\n            resolve(checkStatus);\n          }\n        }).then(function () {\n          if (!_this.required && isEmpty(value)) {\n            resolve({\n              hasError: false\n            });\n          }\n        }).then(function () {\n          return validator(value, _this.rules);\n        }).then(function (checkStatus) {\n          if (checkStatus) {\n            resolve(checkStatus);\n          }\n          resolve({\n            hasError: false\n          });\n        });\n      });\n    }\n  }, {\n    key: \"pushRule\",\n    value: function pushRule(rule) {\n      var _a, _b;\n      var onValid = rule.onValid,\n        errorMessage = rule.errorMessage,\n        priority = rule.priority,\n        params = rule.params;\n      var nextRule = {\n        onValid: onValid,\n        params: params,\n        isAsync: rule.isAsync,\n        errorMessage: errorMessage || ((_b = (_a = this.rules) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.errorMessage)\n      };\n      if (priority) {\n        this.priorityRules.push(nextRule);\n      } else {\n        this.rules.push(nextRule);\n      }\n    }\n  }, {\n    key: \"addRule\",\n    value: function addRule(onValid, errorMessage, priority) {\n      this.pushRule({\n        onValid: onValid,\n        errorMessage: errorMessage,\n        priority: priority\n      });\n      return this;\n    }\n  }, {\n    key: \"addAsyncRule\",\n    value: function addAsyncRule(onValid, errorMessage, priority) {\n      this.pushRule({\n        onValid: onValid,\n        isAsync: true,\n        errorMessage: errorMessage,\n        priority: priority\n      });\n      return this;\n    }\n  }, {\n    key: \"isRequired\",\n    value: function isRequired() {\n      var errorMessage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.locale.isRequired;\n      var trim = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      this.required = true;\n      this.trim = trim;\n      this.requiredMessage = errorMessage;\n      return this;\n    }\n  }, {\n    key: \"isRequiredOrEmpty\",\n    value: function isRequiredOrEmpty() {\n      var errorMessage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.locale.isRequiredOrEmpty;\n      var trim = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      this.required = true;\n      this.trim = trim;\n      this.emptyAllowed = true;\n      this.requiredMessage = errorMessage;\n      return this;\n    }\n    /**\n     * Define data verification rules based on conditions.\n     * @param validator\n     * @example\n     * MixedType().when(schema => {\n     *   return schema.filed1.check() ? NumberType().min(5) : NumberType().min(0);\n     * });\n     */\n  }, {\n    key: \"when\",\n    value: function when(condition) {\n      var _this2 = this;\n      this.addRule(function (value, data, filedName) {\n        return condition(_this2.schemaSpec).check(value, data, filedName);\n      }, undefined, true);\n      return this;\n    }\n  }]);\n  return MixedType;\n}();\nexport default function getMixedType() {\n  return new MixedType();\n}","map":{"version":3,"names":["checkRequired","createValidator","createValidatorAsync","isEmpty","formatErrorMessage","locales","MixedType","name","_classCallCheck","required","requiredMessage","trim","emptyAllowed","rules","priorityRules","typeName","locale","Object","assign","mixed","_createClass","key","value","setSchemaOptions","schemaSpec","check","arguments","length","undefined","data","fieldName","hasError","errorMessage","validator","checkStatus","checkAsync","_this","Promise","resolve","then","pushRule","rule","onValid","priority","params","nextRule","isAsync","_b","_a","push","addRule","addAsyncRule","isRequired","isRequiredOrEmpty","when","condition","_this2","filedName","getMixedType"],"sources":["/home/asmane/vtc/node_modules/schema-typed/src/MixedType.ts"],"sourcesContent":["import {\n  SchemaDeclaration,\n  CheckResult,\n  ValidCallbackType,\n  AsyncValidCallbackType,\n  RuleType,\n  ErrorMessageType,\n  TypeName\n} from './types';\nimport {\n  checkRequired,\n  createValidator,\n  createValidatorAsync,\n  isEmpty,\n  formatErrorMessage\n} from './utils';\nimport locales, { MixedTypeLocale } from './locales';\n\nexport class MixedType<ValueType = any, DataType = any, E = ErrorMessageType, L = any> {\n  readonly typeName?: string;\n  protected required = false;\n  protected requiredMessage: E | string = '';\n  protected trim = false;\n  protected emptyAllowed = false;\n  protected rules: RuleType<ValueType, DataType, E | string>[] = [];\n  protected priorityRules: RuleType<ValueType, DataType, E | string>[] = [];\n\n  schemaSpec: SchemaDeclaration<DataType, E>;\n  value: any;\n  locale: L & MixedTypeLocale;\n\n  constructor(name?: TypeName) {\n    this.typeName = name;\n    this.locale = Object.assign(name ? locales[name] : {}, locales.mixed) as L & MixedTypeLocale;\n  }\n\n  setSchemaOptions(schemaSpec: SchemaDeclaration<DataType, E>, value: any) {\n    this.schemaSpec = schemaSpec;\n    this.value = value;\n  }\n\n  check(value: ValueType = this.value, data?: DataType, fieldName?: string | string[]) {\n    if (this.required && !checkRequired(value, this.trim, this.emptyAllowed)) {\n      return {\n        hasError: true,\n        errorMessage: formatErrorMessage(this.requiredMessage, { name: fieldName })\n      };\n    }\n\n    const validator = createValidator<ValueType, DataType, E | string>(data, fieldName);\n\n    const checkStatus = validator(value, this.priorityRules);\n\n    if (checkStatus) {\n      return checkStatus;\n    }\n\n    if (!this.required && isEmpty(value)) {\n      return { hasError: false };\n    }\n\n    return validator(value, this.rules) || { hasError: false };\n  }\n\n  checkAsync(\n    value: ValueType = this.value,\n    data?: DataType,\n    fieldName?: string | string[]\n  ): Promise<CheckResult<E | string>> {\n    if (this.required && !checkRequired(value, this.trim, this.emptyAllowed)) {\n      return Promise.resolve({\n        hasError: true,\n        errorMessage: formatErrorMessage(this.requiredMessage, { name: fieldName })\n      });\n    }\n\n    const validator = createValidatorAsync<ValueType, DataType, E | string>(data, fieldName);\n\n    return new Promise(resolve =>\n      validator(value, this.priorityRules)\n        .then((checkStatus: CheckResult<E | string> | void | null) => {\n          if (checkStatus) {\n            resolve(checkStatus);\n          }\n        })\n        .then(() => {\n          if (!this.required && isEmpty(value)) {\n            resolve({ hasError: false });\n          }\n        })\n        .then(() => validator(value, this.rules))\n        .then((checkStatus: CheckResult<E | string> | void | null) => {\n          if (checkStatus) {\n            resolve(checkStatus);\n          }\n          resolve({ hasError: false });\n        })\n    );\n  }\n  protected pushRule(rule: RuleType<ValueType, DataType, E | string>) {\n    const { onValid, errorMessage, priority, params } = rule;\n    const nextRule = {\n      onValid,\n      params,\n      isAsync: rule.isAsync,\n      errorMessage: errorMessage || this.rules?.[0]?.errorMessage\n    };\n\n    if (priority) {\n      this.priorityRules.push(nextRule);\n    } else {\n      this.rules.push(nextRule);\n    }\n  }\n  addRule(\n    onValid: ValidCallbackType<ValueType, DataType, E | string>,\n    errorMessage?: E | string,\n    priority?: boolean\n  ) {\n    this.pushRule({ onValid, errorMessage, priority });\n    return this;\n  }\n  addAsyncRule(\n    onValid: AsyncValidCallbackType<ValueType, DataType, E | string>,\n    errorMessage?: E | string,\n    priority?: boolean\n  ) {\n    this.pushRule({ onValid, isAsync: true, errorMessage, priority });\n    return this;\n  }\n  isRequired(errorMessage: E | string = this.locale.isRequired, trim = true) {\n    this.required = true;\n    this.trim = trim;\n    this.requiredMessage = errorMessage;\n    return this;\n  }\n  isRequiredOrEmpty(errorMessage: E | string = this.locale.isRequiredOrEmpty, trim = true) {\n    this.required = true;\n    this.trim = trim;\n    this.emptyAllowed = true;\n    this.requiredMessage = errorMessage;\n    return this;\n  }\n\n  /**\n   * Define data verification rules based on conditions.\n   * @param validator\n   * @example\n   * MixedType().when(schema => {\n   *   return schema.filed1.check() ? NumberType().min(5) : NumberType().min(0);\n   * });\n   */\n  when(condition: (schemaSpec: SchemaDeclaration<DataType, E>) => MixedType) {\n    this.addRule(\n      (value, data, filedName) => {\n        return condition(this.schemaSpec).check(value, data, filedName);\n      },\n      undefined,\n      true\n    );\n    return this;\n  }\n}\n\nexport default function getMixedType<DataType = any, E = ErrorMessageType>() {\n  return new MixedType<DataType, E>();\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}